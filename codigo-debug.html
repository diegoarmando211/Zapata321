<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üîß C√≥digo Google Apps Script Mejorado</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
    .code-box { background: #f5f5f5; border: 1px solid #ddd; padding: 15px; border-radius: 5px; margin: 15px 0; }
    .code-box pre { margin: 0; white-space: pre-wrap; }
    .step { background: #e7f3ff; border-left: 4px solid #2196F3; padding: 10px; margin: 10px 0; }
    .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px; margin: 10px 0; }
  </style>
</head>
<body>
  <h1>üîß C√≥digo Google Apps Script Mejorado</h1>
  
  <div class="warning">
    <strong>‚ö†Ô∏è PROBLEMA DETECTADO:</strong> Tu Google Sheets solo est√° devolviendo 1 cliente de los 3 que dices tener.
  </div>

  <div class="step">
    <h3>üìã PASO 1: Copia este c√≥digo en tu Google Apps Script</h3>
    <p>Este c√≥digo te mostrar√° <strong>TODOS</strong> los datos sin filtrar para que puedas ver qu√© est√° pasando:</p>
  </div>

  <div class="code-box">
<pre>function doGet(e) {
  try {
    // Tu ID de hoja espec√≠fico
    const sheet = SpreadsheetApp.openById("1KL7D7vw1TdCeOlOp6NeMEGzvulNrP2VRq03oKezdZ1s").getActiveSheet();
    const data = sheet.getDataRange().getValues();
    
    console.log("=== DEBUG COMPLETO ===");
    console.log("Total de filas encontradas:", data.length);
    console.log("Datos completos:", data);
    
    if (data.length < 1) {
      return ContentService.createTextOutput('recibirClientesGoogleSheets([])').setMimeType(ContentService.MimeType.JAVASCRIPT);
    }
    
    // Mostrar headers (primera fila)
    const headers = data[0];
    console.log("Headers encontrados:", headers);
    
    // Mostrar todas las filas de datos
    const todasLasFilas = data.slice(1);
    console.log("Filas de datos (sin headers):", todasLasFilas);
    
    // Procesar TODOS los datos (sin filtrar por ahora)
    const todosLosClientes = todasLasFilas.map((row, index) => {
      const cliente = { fila: index + 2 }; // +2 porque empezamos en fila 1 y saltamos header
      headers.forEach((header, colIndex) => {
        cliente[header] = row[colIndex];
      });
      return cliente;
    });
    
    console.log("Todos los clientes procesados:", todosLosClientes);
    
    // Filtrar solo los que tienen NombreCliente Y Telefono
    const clientesFiltrados = todosLosClientes.filter(cliente => {
      const tieneNombre = cliente.NombreCliente && cliente.NombreCliente.toString().trim() !== '';
      const tieneTelefono = cliente.Telefono && cliente.Telefono.toString().trim() !== '';
      console.log(`Cliente fila ${cliente.fila}: Nombre="${cliente.NombreCliente}" (${tieneNombre}) | Telefono="${cliente.Telefono}" (${tieneTelefono})`);
      return tieneNombre && tieneTelefono;
    });
    
    console.log("Clientes despu√©s del filtro:", clientesFiltrados);
    
    const callback = e.parameter.callback || 'recibirClientesGoogleSheets';
    const response = `${callback}(${JSON.stringify(clientesFiltrados)})`;
    
    return ContentService.createTextOutput(response).setMimeType(ContentService.MimeType.JAVASCRIPT);
  } catch (error) {
    console.error('Error completo:', error);
    const callback = e.parameter.callback || 'recibirClientesGoogleSheets';
    return ContentService.createTextOutput(`${callback}([])`).setMimeType(ContentService.MimeType.JAVASCRIPT);
  }
}</pre>
  </div>

  <div class="step">
    <h3>üìã PASO 2: Pasos a seguir</h3>
    <ol>
      <li><strong>Ve a <a href="https://script.google.com/" target="_blank">Google Apps Script</a></strong></li>
      <li><strong>Abre tu proyecto</strong></li>
      <li><strong>Reemplaza todo el c√≥digo</strong> con el de arriba</li>
      <li><strong>Guarda</strong> (Ctrl+S)</li>
      <li><strong>Nueva implementaci√≥n</strong>:
        <ul>
          <li>Implementar ‚Üí Nueva implementaci√≥n</li>
          <li>Tipo: Aplicaci√≥n web</li>
          <li>Ejecutar como: Yo</li>
          <li>Acceso: Cualquier usuario</li>
        </ul>
      </li>
      <li><strong>Copia la nueva URL</strong></li>
      <li><strong>Ve a "Execution transcript"</strong> (logs) para ver los console.log</li>
    </ol>
  </div>

  <div class="step">
    <h3>üîç PASO 3: Revisar logs</h3>
    <p>En Google Apps Script, ve a <strong>"Ejecuciones"</strong> o <strong>"Execution transcript"</strong> para ver los console.log que te dir√°n exactamente:</p>
    <ul>
      <li>‚úÖ <strong>Cu√°ntas filas</strong> encuentra en total</li>
      <li>‚úÖ <strong>Qu√© headers</strong> encuentra</li>
      <li>‚úÖ <strong>Todos los datos</strong> de cada fila</li>
      <li>‚úÖ <strong>Por qu√© se filtran</strong> algunos clientes</li>
    </ul>
  </div>

  <div class="warning">
    <h3>üéØ Problemas m√°s comunes:</h3>
    <ul>
      <li><strong>Headers mal escritos:</strong> Debe ser exactamente "NombreCliente" y "Telefono" (sin espacios extra)</li>
      <li><strong>Celdas vac√≠as:</strong> Alg√∫n cliente no tiene nombre o tel√©fono</li>
      <li><strong>Filas vac√≠as:</strong> Hay filas vac√≠as entre tus datos</li>
      <li><strong>Datos en otra hoja:</strong> Los datos est√°n en una hoja diferente a la activa</li>
    </ul>
  </div>
</body>
</html>