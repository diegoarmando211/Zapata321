function doGet(e) {
  try {
    // Tu ID de hoja CORRECTO
    const spreadsheet = SpreadsheetApp.openById("1DJq9iMVlQLXt5w_NaxnITAJ3m3CwcOetvCE9PqDNU6E");
    
    // Listar todas las hojas disponibles
    const allSheets = spreadsheet.getSheets();
    console.log("=== DEBUG COMPLETO v5 - ID CORRECTO ===");
    console.log("Hojas disponibles:");
    allSheets.forEach((sheet, index) => {
      console.log(`- Hoja ${index}: "${sheet.getName()}" (${sheet.getLastRow()} filas)`);
    });
    
    // Intentar obtener la hoja por diferentes métodos
    let sheet;
    
    // Método 1: Obtener la primera hoja (Hoja1)
    try {
      sheet = spreadsheet.getSheetByName("Hoja1");
      console.log("✅ Usando hoja 'Hoja1'");
    } catch (error) {
      console.log("❌ No se encontró 'Hoja1'");
    }
    
    // Método 2: Si no hay Hoja1, usar la primera hoja disponible
    if (!sheet) {
      sheet = allSheets[0];
      console.log(`✅ Usando primera hoja: "${sheet.getName()}"`);
    }
    
    // Método 3: Forzar recarga y obtener datos
    console.log(`Obteniendo datos de: "${sheet.getName()}"`);
    console.log(`Última fila con datos: ${sheet.getLastRow()}`);
    console.log(`Última columna con datos: ${sheet.getLastColumn()}`);
    
    // Obtener TODOS los datos de la hoja
    const data = sheet.getDataRange().getValues();
    
    console.log("Total de filas leídas:", data.length);
    console.log("Datos RAW completos:", JSON.stringify(data));
    
    if (data.length < 2) {
      console.log("ERROR: No hay suficientes datos");
      const callback = (e && e.parameter && e.parameter.callback) ? e.parameter.callback : 'recibirClientesGoogleSheets';
      return ContentService.createTextOutput(`${callback}([])`).setMimeType(ContentService.MimeType.JAVASCRIPT);
    }
    
    // Headers (primera fila)
    const headers = data[0];
    console.log("Headers encontrados:", headers);
    
    // Buscar índices de columnas
    const indexID = headers.indexOf('ID');
    const indexNombre = headers.indexOf('NombreCliente');
    const indexTelefono = headers.indexOf('Telefono');
    
    console.log("Índices de columnas:");
    console.log("- ID:", indexID);
    console.log("- NombreCliente:", indexNombre);
    console.log("- Telefono:", indexTelefono);
    
    if (indexNombre === -1 || indexTelefono === -1) {
      console.log("ERROR: No se encontraron las columnas requeridas");
      const callback = (e && e.parameter && e.parameter.callback) ? e.parameter.callback : 'recibirClientesGoogleSheets';
      return ContentService.createTextOutput(`${callback}([])`).setMimeType(ContentService.MimeType.JAVASCRIPT);
    }
    
    // Procesar todas las filas de datos (saltar header)
    const filasDeatos = data.slice(1);
    console.log(`Procesando ${filasDeatos.length} filas de datos:`);
    
    const clientesValidos = [];
    
    filasDeatos.forEach((fila, index) => {
      const numeroFila = index + 2;
      console.log(`\n--- PROCESANDO FILA ${numeroFila} ---`);
      console.log("Datos de la fila:", fila);
      
      // Extraer datos
      const cliente = {
        fila: numeroFila,
        ID: indexID >= 0 ? fila[indexID] : null,
        NombreCliente: fila[indexNombre],
        Telefono: fila[indexTelefono]
      };
      
      console.log("Cliente extraído:", cliente);
      
      // Validar datos
      const nombreValido = cliente.NombreCliente && 
                          cliente.NombreCliente.toString().trim() !== '' &&
                          cliente.NombreCliente.toString().trim() !== 'undefined';
      const telefonoValido = cliente.Telefono && 
                            cliente.Telefono.toString().trim() !== '' &&
                            cliente.Telefono.toString().trim() !== 'undefined';
      
      console.log(`Validación fila ${numeroFila}:`);
      console.log(`- Nombre: "${cliente.NombreCliente}" (válido: ${nombreValido})`);
      console.log(`- Teléfono: "${cliente.Telefono}" (válido: ${telefonoValido})`);
      
      if (nombreValido && telefonoValido) {
        clientesValidos.push(cliente);
        console.log(`✅ Cliente fila ${numeroFila} AGREGADO`);
      } else {
        console.log(`❌ Cliente fila ${numeroFila} RECHAZADO`);
      }
    });
    
    console.log("\n=== RESULTADO FINAL ===");
    console.log("Clientes válidos encontrados:", clientesValidos.length);
    console.log("Lista final:", JSON.stringify(clientesValidos));
    
    if (clientesValidos.length !== 3) {
      console.log("⚠️ ADVERTENCIA: Se esperaban 3 clientes pero se encontraron", clientesValidos.length);
    }
    
    // Manejar callback de forma segura
    const callback = (e && e.parameter && e.parameter.callback) ? e.parameter.callback : 'recibirClientesGoogleSheets';
    const response = `${callback}(${JSON.stringify(clientesValidos)})`;
    
    console.log("Callback usado:", callback);
    
    return ContentService.createTextOutput(response).setMimeType(ContentService.MimeType.JAVASCRIPT);
    
  } catch (error) {
    console.error('ERROR CRÍTICO:', error);
    console.error('Stack:', error.stack);
    
    const callback = (e && e.parameter && e.parameter.callback) ? e.parameter.callback : 'recibirClientesGoogleSheets';
    return ContentService.createTextOutput(`${callback}([])`).setMimeType(ContentService.MimeType.JAVASCRIPT);
  }
}